{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ce2e5337747630955c5f","webpack:///external \"lodash.get\"","webpack:///./src/Store/Store.js","webpack:///./src/Store/index.js","webpack:///./src/Engine/Engine.js","webpack:///./src/Engine/index.js","webpack:///./src/constants.js","webpack:///./src/util.js","webpack:///./src/EngineMerger/EngineMerger.js","webpack:///./src/EngineMerger/index.js","webpack:///./src/Change/Change.js","webpack:///./src/Change/index.js","webpack:///./src/index.js","webpack:///./src/bottle.js","webpack:///external \"bottlejs\""],"names":["bottle","isPromise","constructor","props","stop","_idFromProps","Store","id","lGet","Number","_parseProps","initializer","firstState","debug","noChangeBeforeInit","_initStateStream","distinctUntilChanged","_initErrorStream","_initDebugStream","params","data","change","JSON","type","store_state","store_status","source","message","_initStream","status","_resolveChangePromise","call","error","_resolveChangeFunction","_extendParams","done","fail","Object","_delayedChange","_changeError","_initChangeStream","onChange","Promise","init","changeRecord","_setState","_setStatus","subscribe","initialize","onInit","sub","_debugMessage","store","Change","actions","_initActionStream","onAction","actionStatus","_getTID","perform","tid","mutator","engine","Symbol","out","first","result","err","fn","promise","delta","subject","state","Array","baseActions","actionsMemo","action","STORE_STATE_UNSET_VALUE","states","newState","console","STATUS_MAP","_listenToEngineStreams","e","_updateState","engines","failed","setTimeout","reject","clearTimeout","obj","engineMerger","explodePromise","extend","callbacks","functionCombine","combinedParams","toJSON","name","asPromise","after","propper","defaultValue","required","onInvalid","tests","isGood","n","Bottle","constants","util","container","StoreEngine","StoreEngineReducer","update","mergeIntoState","STORE_STATUS_NEW","STORE_STATUS_INITIALIZED","STORE_STATUS_INITIALIZING","STORE_STATUS_INITIALIZATION_ERROR","ACTION_ERROR","ACTION_START","ACTION_NOOP","ACTION_COMPLETE","NOT_SET"],"mappings":"AAAA,eACA,iDADA,CAEA,kBAFA,CAGA,qCAHA,CAIA,wBAJA,CAKA,wBALA,CAMA,qBANA,CAQA,eACC,CATD,EASC,kCATD,CASC,WACD,M,aCNA,cAGA,QACA,oBAGA,YACA,GADA,CAEA,IAFA,CAGA,UAHA,EAaA,MANA,mCAMA,CAHA,MAGA,UACA,CAxBA,SA4DA,MAhCA,MAgCA,CA7BA,KA6BA,CA1BA,oBACA,QADA,EAEA,2BACA,eADA,CAEA,aAFA,CAGA,KAHA,EAMA,CAkBA,CAfA,gBACA,sBACA,WAA2B,mBAA4B,CADvD,CAEA,WAAiC,QAAe,CAFhD,CAIA,MADA,aACA,EACA,CASA,CANA,kBAAsD,gDAA+D,CAMrH,CAHA,MAGA,S,eC7DA,+B,cAAA,yB,cAAA,mC,cAAA,qC,mxBCMgBA,EAAD,KAAY,CACzBA,kBAEE,CAAC,8LASUC,WATV,CAAD,GAUM,CACJ,OAAY,CACVC,YAAYC,EAAZD,KAA0B,CACxB,oBADwB,CAExB,mBAFwB,CAIxB,wBAJwB,CAKxB,uBALwB,CAMxB,uBANwB,CAOxB,kBAPwB,CAUpB,KAAJ,MAVwB,EAWtB,uBAXsB,CAcxB,kBACD,CAEDE,MAAO,CACL,kBADK,CAEL,6BAFK,CAGL,4BAHK,CAIL,uBAJK,CAKL,4BALK,CAMD,KAAJ,YANK,EAMkB,4BACxB,CAEDC,eAAoB,CAElB,GADKC,EAAL,OACA,GADoBA,WACpB,IAAW,CACT,KAAMC,GAAKC,MAAX,IAAWA,CAAX,CACA,GAAI,GAAQC,OAAR,SAAQA,GAAR,EAAiCF,GAAMD,EAA3C,QAGE,MAFA,UAEA,MADAA,SAAeC,EAAfD,CACA,EACSC,GAAJ,QAAW,UANT,GAOP,SAPO,CASV,CACDD,YAZkB,CAalB,QAAUA,EAAV,OACD,CAaDI,cAAmB,CAGjB,GAFA,oBAEA,CADA,kBACA,IAAY,OACZ,UAAI,UAJa,GAKfP,EAAQ,CAARA,aAAQ,CALO,KAOjB,KAPiB,CAQbQ,EAAJ,IARiB,CASjB,GATiB,CAUjB,IAViB,CAYjB,QAAI,UAZa,EAaX,aAAJ,iBAbe,EAcbA,EAAcH,MAAdG,aAAcH,GAdD,CAebI,EAAaJ,MAAbI,OAAaJ,GAfA,CAgBbK,EAAQL,MAARK,OAAQL,GAhBK,CAiBbM,EAAqBN,MAArBM,oBAAqBN,GAjBR,EAmBbI,GAnBa,CAsBf,kBAtBe,CAuBf,mBAvBe,EAyBf,kBAzBe,CA4BjB,0BA5BiB,CA6BjB,aACD,CAEDG,kBAAmB,CACjB,kBAAoB,sBAAoB,KAApB,kBACZC,OADR,sBACQA,GADY,CADH,CAGjB,4BAA4B,KAAU,CACpC,aADF,EAGD,CAEDC,kBAAmB,CACjB,kBAAoB,6BACZD,OADR,sBACQA,GADY,CAErB,CAEDE,kBAAmB,CACjB,kBAAoB,6BACZ,cAAI,KAAU,CAClB,KAAMC,GAASC,EAAf,OACA,GAAIC,GAAJ,KACA,kBAA8B,CAC5B,OAAQF,EAAR,MACE,YACE,WAAI,QAAOA,GAAP,MAAJ,CACEE,EAASF,SAATE,QAASF,EADX,KAGE,IAAI,CACFE,EAASC,eAAeH,EAAxBE,MAASC,CADX,CAEE,QAAY,CACZD,EAASF,EAATE,MACD,CAEH,MAEF,QACEA,EAAU,aAAYF,EAAOI,IAA7BF,EADF,CAbF,CAgBA,MAAO,oBAAwB,CAC7BG,YAAa,KADgB,MACJC,aAAc,KADV,OACuBJ,QADvB,CAAxB,CAGR,CACD,MAAO,oBAAwB,CAC7BG,YAAa,KADgB,MACJC,aAAc,KADV,OACuBN,QADvB,CAAxB,CAzBX,CACQ,CADY,CADH,CA8BjB,4BAA4B,KAAW,CACrC,uBAAuB,CACrBO,OADqB,oBAErBC,QAFqB,QAGrBR,QAHqB,CAAvB,CADF,EA9BiB,CAsCjB,6BAA6B,KAAY,CACvC,uBAAuB,CACrBO,OADqB,sBAErBC,QAFqB,SAGrBR,QAHqB,CAAvB,CADF,EAtCiB,CA8CjB,4BAA4B,KAAW,CACrC,uBAAuB,CACrBO,OADqB,oBAErBC,QAFqB,QAGrBR,QAHqB,CAAvB,CADF,EAOD,CAEDS,aAAc,CACZ,aAAe,wBAAc,KAAd,aAAiC,KAAjC,oBACP,cAAI,UAAsC,SAE9CC,QAF8C,CAAtC,CAAJ,CADO,CAIRb,OAJP,sBAIOA,GAJQ,CAKhB,CAEDc,wBAA8B,sDAO5B,MADA,mDACA,CAAO,OACC,KAAe,CACnB,4DAA8D,UAA9D,WAA8D,CAA9D,CADmB,CAEnB,+BAHG,SAKE,KAAW,CAChBC,MADgB,CAEhB,+BAEEC,OAFF,GAPJ,CAAO,CAYR,CAEDC,yBAA+B,CAC7B,yDAD6B,CAE7B,oBAAyBZ,OAAQF,SAAc,KAA/C,KAAiCA,CAAjC,GACD,CAUDe,kBAAiC,CAC/B,aAAI,UAAJ,CACE,MAAO,oBAAmB,CAA1B,QAA0B,CAAnB,GAAP,CAEF,QACE,MAAO,oBAAmB,CAA1B,QAA0B,CAAnB,GAAP,CAL6B,6CAU/B,IAV+B,CAW/B,GAX+B,CA2B/B,WAbEC,EAAO,kCACL,uBAAMJ,IAAN,IAAMA,CAAN,sBACA,SAAOA,IAAP,IAAOA,CAAP,CADA,0BADFI,CAAO,CAaT,MANEC,EAAO,kCACL,uBAAML,IAAN,IAAMA,CAAN,sBACA,SAAOA,IAAP,IAAOA,CAAP,CADA,0BADFK,CAAO,CAMT,EAAOC,qBAAqC,QAA5C,MAA4C,CAArCA,CACR,CAEDC,iBAAuB,CAErB,qFAFqB,CAGrB,cACD,CAEDC,iBAA4B,qCAK1B,gEAL0B,CAO1BR,QAP0B,CAQ1B,+BAEEC,OAFF,GAID,CAEDQ,mBAAoB,CAClB,mBAAqB,GAArB,kBAAqB,GADH,CAElB,6BAA6BrB,KAAU,KAAvC,QAAuC,GAAvC,CAA8D,KAAW,CACvE,uBAAuB,CACrBQ,QADqB,sBAErBK,OAFqB,CAAvB,CADF,EAMD,CAEDS,aAA2B,CACzB,UAIA,WAAI,UAAJ,CAEE,WADA,eAAc,CAAd,QAAc,CAAd,CACA,CAPuB,0DAgBzB,GAAI,KAAJ,kBAEE,WADA,mBAAkB,KAAlB,sBACA,CAGF,MAEE,WADA,mBAAkB,UAAlB,qBAAkB,CAAlB,GACA,CAGF,GAAI,0BAAJ,GACE,OAAQ,KAAR,QACE,OAEE,WADA,qEACA,CAGF,OAEE,WADA,mEACA,CAGF,QAXF,CA1BF,MA0CA,KA1CA,KA2CE,8BA3CF,CA+CA,UAAI,UA/CJ,KAgDE,+BAhDF,CAoDK,KAAL,aApDA,SA2DA,iBA3DA,IA8DE,kBA9DF,CAgEAV,IAAW,KAAXA,MAhEA,MAsDI,uBAtDJ,CAiED,CAEDV,WAAyB,CACvB,SAAwB,MAAOqB,SAAP,OAAOA,GAAP,CACxB,QACI,oBAAgCvB,EAApC,MAHuB,GAIrBwB,EAAO,CAAPA,QAAO,CAJc,EAMvB,KAAMC,GAAe,iBAArB,SANuB,MAOGA,EAPH,SAOGA,EAPH,8BASvB,MADA,2BACA,EACD,CAED,WAAY,CACV,MAAO,MAAP,MACD,CAEDC,cAA2B,CACzB,KADyB,EAEvB,yBAEH,CAED,YAAa,CACX,MAAO,MAAP,OACD,CAEDC,aAAmB,CACb,UAAJ,QAAI,GADa,GAOf,cAPe,CASlB,CAEDC,eAAmB,CACjB,MAAO,6BAAP,IAAO,CACR,CAED,oBAAqB,CACnB,MAAO,MAAP,MAAO,IACR,CAED,wBAAyB,CACvB,MAAO,qBAAsB,KAA7B,iBACD,CAED,mBAAoB,CAClB,MAAQ,MAAR,MAAQ,IACT,CAED,uBAAwB,CACtB,MAAQ,MAAR,MAAQ,IACT,CAEDC,YAAa,QACX,4DADW,CAEP,KAAJ,YAFW,EAEmB,KAAP,YAFZ,EAGX,eAAe,KAAf,YAHW,CAIX,kBAJW,CAMT,iBANS,CAKP,KAAJ,YALW,CAMW,YAAY,CAC9B3B,OAAQ,KADsB,aACHQ,QADG,CAAZ,CANX,CAUW,YAAY,CAC9BR,OAAQ,KADsB,YACJQ,QADI,CAAZ,CAVX,CAcJ,KAAP,YAdW,CAeZ,CAUDoB,SAAe,gBAKb,GAAI,KAAJ,cACE,MAAO,MAAP,MAAO,GAAP,CAGF,GAAI,KAAJ,kBAEE,MADAlB,KAAW,KAAXA,oBACA,CAAOW,eAAe,KAAtB,mBAAOA,CAAP,CAGF,MACA,cADA,GAEEE,QAFF,CAda,MAqBaA,EArBb,SAqBaA,EArBb,8BAuBPM,EAAM,6BACV,KAAY,CACV,UACE,OACEA,eADF,CAEE,cAFF,CAGE,MAEF,OACEA,eADF,CAEEnB,EAAKV,EAALU,KAAkB,KAAlBA,yBAFF,CAGE,MAEF,QAXF,CAFQ,EAgBV,KAAW,CACTA,EAAKV,EAALU,YAjBJ,CAAY,CAvBC,CA4Cb,QACD,CAEDoB,oBAAuC,CACjC,KAAJ,MADqC,EAEnC,uBAAuB,oBAGrBhC,QAHqB,CAAvB,CAMH,CA7cS,CAgdZ,QA7dJnB,EADF,C,CCJgBA,EAAD,KAAY,CACzBoD,IADF,C,kKCGgBpD,EAAD,KAAY,CACzBA,mBAEE,CAAC,mPAaQqD,QAbR,CAAD,GAcM,CACJ,iBAA2B,CACzBnD,gBAA6B,CAC3B,QAD2B,CAE3B,wBAF2B,CAG3B,cAAgBoD,GAAhB,QAH2B,CAI3B,iBACD,CAED,aAAc,CACZ,GAAI,CAAC,KAAL,SAAoB,CAClB,WAEAjB,YAAY,KAAZA,kBACW,KAAY,CACnBiB,KAAkB,QAAe,aAAa,oBAG5CnC,QAH4C,CAAb,CAFrCkB,EAHkB,CAYlB,eACD,CACD,MAAO,MAAP,QACD,CAEDkB,mBAAoB,CAClB,kBAAoB,GAApB,kBADkB,CAElB,4BAA4BpC,KAAU,KAAtC,QAAsC,GAAtC,CAA6D,KAAW,CACtE,uBAAuB,CAAEQ,QAAF,eAAvB,OAAuB,CAAvB,CADF,EAGD,CAED6B,WAAuB,CACrB,MACA,yCADA,CADqB,uDACrB,UAQE,KARF,MAiBA,KAjBA,EAkBE,wDAlBF,CAmBE,YAAY,SAAoB,CAC9BrB,KAAM,IAAM,CACV,uBAAuB,SAAoB,CACzCsB,cADyC,CAApB,CAAvB,CAF4B,EAM9BrB,KAAM,KAAW,CACf,uBAAuB,SAAoB,SAClCqB,cADkC,CAApB,CAAvB,CAP4B,EAW9BA,cAX8B,CAApB,CAAZ,CAnBF,EAgCO,KAhCP,CAiCE1B,EAAKvB,MAALuB,MAAKvB,CAALuB,CAjCF,CAmCE,4DAnCF,MASI,wBAAuB,SAAoB,gBAEzCC,MAAO,UAAW,sBAAqBxB,qBAAhC,GAFkC,CAApB,CAAvB,CATJ,CAqCD,CAEDkD,SAAU,CAKR,MAJK,MAAL,IAIA,GAHE,WAGF,EADA,YACA,CAAO,KAAP,IACD,CAEDC,UAAgB,CACd,KAAMf,GAAe,cAEnBgB,IAAK,KAFc,OAEd,EAFc,CAGnBH,cAHmB,GAArB,CADc,gDASM,KATN,qBAWd,KAAMI,GAAUrD,IAAK,KAArB,QAAgBA,GAAhB,CAGIqD,GAAJ,UAAe,UAdD,GAeZjB,SAAsBiB,IAAtBjB,IAAsBiB,CAfV,EAiBd,0CAjBc,OAkB4BjB,EAlB5B,SAkB4BA,EAlB5B,8BAsBd,MAFA,0BAEA,EACD,CAxGwB,CA2G3B,QA5HJ5C,EADF,C,CCHgBA,EAAD,KAAY,CACzB8D,IADF,C,CCAgB9D,EAAD,KAAY,CACzBA,qCAA2C+D,OAA3C/D,yBAA2C+D,CAA3C/D,CADyB,CAEzBA,8BAAoC+D,OAApC/D,kBAAoC+D,CAApC/D,CAFyB,CAGzBA,sCAA4C+D,OAA5C/D,0BAA4C+D,CAA5C/D,CAHyB,CAIzBA,kCAAwC+D,OAAxC/D,sBAAwC+D,CAAxC/D,CAJyB,CAKzBA,uCAA6C+D,OAA7C/D,2BAA6C+D,CAA7C/D,CALyB,CAMzBA,+CAAqD+D,OAArD/D,mCAAqD+D,CAArD/D,CANyB,CAOzBA,0BAAgC+D,OAAhC/D,cAAgC+D,CAAhC/D,CAPyB,CAQzBA,0BAAgC+D,OAAhC/D,cAAgC+D,CAAhC/D,CARyB,CASzBA,yBAA+B+D,OAA/B/D,aAA+B+D,CAA/B/D,CATyB,CAUzBA,6BAAmC+D,OAAnC/D,iBAAmC+D,CAAnC/D,CAVyB,CAWzBA,qBAA2B+D,OAA3B/D,SAA2B+D,CAA3B/D,CAXF,C,CCFgBA,EAAD,KAAY,CAczBA,cAAoB,IAAM,8CACxB,MADwB,sBAexB,MAfwB,QAexB,CAFAgE,UAEA,CADAA,SACA,KAfwB,qCASV,WACZhC,IADY,0BATU,EAGxB,GAAI,+BACF,UAAI,UADF,CAES,gBAAMiC,EAAN,IAAMA,CAAN,6BAATC,IAAS,kDAFT,CAIS,8CAATA,IAAS,kDAJb,CAME,QAAY,CAALC,IAER,CAXHnE,CAA0B,CAA1BA,CAdyB,CAgCzBA,iBAAuB,IAAM,UACvBoE,GAAJ,UAAU,UADiB,CAEzB,IAFyB,CAI3B,IAJFpE,CAhCyB,CAuCzBA,2BAAiC,CAAC,WAAD,WAAC,CAAD,GAA4B,KAAa,IACxE,IADwE,CAExE,GAFwE,CAUxE,MANA,KAMA,EALEmC,EAAO,QAAa,CAApBA,IAAoB,CAKtB,CAJEC,EAAO,QAAa,CAApBA,IAAoB,CAItB,CAHEiC,kBAGF,EAFO,EAAU,YAAY,OAAU,CAAElC,GAAF,CAAYC,GAA5C,CAAU,CAEjB,CAAOC,sBAAqC,eAA5C,SAA4C,CAArCA,CAVTrC,EAvCyB,CAoDzBA,mBAAyB,IAAM,WAAiB,CAC9C,MAAO,UAAsB,KAAW,CACtC,KAAMqB,GAASiD,IAAf,IAAeA,IAAf,CACA,MAAOjC,QAAP,MAAOA,QAFT,CADFrC,EApDyB,CA2DzBA,gBAAsB,IAAM,OAAgB,CAC1C,WAEA,MADAgE,OACA,EAHFhE,EA3DyB,CAiEzBA,yBAjEyB,CAmEzBA,sBAA4B,IAAM,cAE5BuE,YAAJ,QAFgC,GAGzB7B,QAAP,OAAOA,OAHyB,CAAlC1C,CAnEyB,CAyEzBA,4BAAkC,CAAC,CAAD,MAAC,CAAD,GAAc,OAAY,kCAC1D,uBAAM+B,IAAN,IAAMA,CAAN,sBACA,SAAOA,IAAP,IAAOA,CAAP,CADA,0BADF/B,CAA4D,CAA5DA,CAzEyB,CA8EzBA,2BAAiC,IAAMqB,KAAUmD,KAASnC,OAA1DrC,MAA0DqC,QAA1DrC,CA9EF,C,gmBCMgBA,EAAD,KAAY,CACzBA,iCAAuC,IAAM,WAAmB,CAC9D,GAAIyE,MAAJ,OAAIA,GAAJ,CACE,MAAO,UAAe,OAAyB,CAI7C,GAAIC,GAAcC,EAAlB,YAJ6C,IAM7B,MAAiBb,EAA/BY,OAAc,CAN6B,CAQ7B,CAACZ,EAAfY,OAAc,CAR6B,CAU7C,KAAMpB,WAAN,aAAMA,EAAN,CAMA,MALAjB,aAAYyB,EAAZzB,kBAAqC,KAAY,CAC/CiB,KAAkB,QAAe,UAAe,oBAC7BnC,QAD6B,CAAf,CADnCkB,EAKA,EAhBF,CAAO,IAAP,CAkBK,WAAI,UAAJ,CAAiC,CACtC,KAAMiB,GAAU,CAAhB,cAAgB,CAAhB,CAcA,MAZAjB,wBAA6B,KAAgB,CAC3C,KAAMyB,GAAN,KACAR,OAF2C,CAG3CjB,YAAYyB,EAAZzB,kBAAqC,KAAY,CAC/C,KAAMuC,GAAS,QAAe,UAAe,oBAC1BzD,QAD0B,CAAf,CAA9B,CAGAmC,SAJ+C,CAK/CA,MAL+C,CAM/CA,iBAAkCQ,EAAlCR,OANFjB,EAHFA,EAYA,EACD,CACD,KAAM,WAAN,sCAAM,CArCRrC,EADyB,CAyCzBA,gCAAsC,CAAC,CACrC6E,yBADqC,CAAD,GAEhC,KAAY,CAChB,SAAwC,SACxC,GAAIJ,MAAJ,OAAIA,GAAJ,CACE,MAAOK,UAAc,OAArB,SAAOA,IAAP,CACK,WAAI,UAAJ,CAAgC,CACrC,WAOA,MANAzC,wBAA4B,KAAgB,CAC1CA,0BAAwC,KAAe,CACrD0C,YADF1C,EAD0C,CAI1CA,kBAJFA,EAMA,EACD,CAED,KADA2C,4BACA,CAAM,UAAN,yCAAM,CAjBRhF,EAzCyB,CA6DzBA,yBAEE,CAAC,8RAeCM,OAfD,CAAD,GAgBM,CACJ,KAAM2E,GAAa,GAAnB,KACAA,cAFI,CAGJA,gBAHI,CAIJA,sBAJI,CAKJA,uBALI,CAMJA,gBANI,CAQJ,iBAAiC,CAC/B/E,cAAoB,CAClB,QADkB,CAElB,wBAFkB,CAIlB,iBACD,CAEDQ,cAAoB,CAClB,oBADkB,CAGlB,aAAeF,MAAf,SAAeA,IAHG,CAIlB,mBAAqBA,MAArB,cAAqBA,GAJH,CAKlB,qBAAuBA,MAAvB,eAAuBA,GALL,CAMlB,iBAAmBA,MAAnB,OAAmBA,GAND,CAOlB,kBAAoBA,MAApB,aAAoBA,OAPF,CAQlB,6BARkB,CASlB,YAAcA,MAAd,OAAcA,GACf,CAED,aAAc,CAIZ,MAHK,MAAL,QAGA,GAFE,cAAgB,qBAAqB,KAArC,OAAgB,CAElB,EAAO,KAAP,QACD,CAED0E,wBAAyB,CACvB,0BAA0BC,KAAK,YAAY,IAAM,CAC/C,mBAD6B,EAE5B,KAAS,CACVH,4BAH6B,EAI5B,IAAM,CACPA,+BALF,CAA+B,CAA/B,CAOD,CAEDI,cAAe,CACT,KAAJ,MAAI,IADS,EAEX,uBAAuB,mBAAmB,KAA1C,MAAuB,CAAvB,CAEH,CAED7B,mBAAoB,CAClB,kBAAoB,GAApB,kBADkB,CAElB,4BAA4BpC,KAAU,KAAtC,QAAsC,GAAtC,CAA6D,KAAW,CACtE,uBAAuB,CAAEQ,QAAF,eAAvB,OAAuB,CAAvB,CADF,EAGD,CAEDqB,YAAa,QACX,6DADW,CAEP,KAAJ,YAFW,EAEmB,KAAP,YAFZ,EAGX,eAAe,KAAf,EAHW,CAIX,kBAJW,CAMT,iBANS,CAKP,KAAJ,YALW,CAMW,YAAY,CAC9B3B,OAAQ,KADsB,gCACtB,EADsB,CACmBQ,QADnB,CAAZ,CANX,CAUW,YAAY,CAC9BR,OAAQ,KADsB,YACJQ,QADI,CAAZ,OAGZ,IAAM,KAHd,gCAGc,EAHM,CAVX,CAeJ,KAAP,YAfW,CAgBZ,CAED,8EAWE,MAVA,KAUA,CAXF,EAEc,KAFd,OAEc,EASZ,CARA,4EAA8E,OAE5EwD,QAAS,KAAKA,OAF8D,CAA9E,CAQA,CAXF,EAOqB,WAAW,IAAM,CAClCC,IADkC,CAElC,YAAY5C,eAAe,UAA3B,8BAA2B,CAAfA,CAAZ,CAFiB,EAGhB,KAVL,YAOqB,CAInB,iBAAM,YAAY,sBAAsB,MACtC,iFAAmF,OAEjFoB,OAAS,UAASA,EAAOvD,EAAG,EAFqD,CAAnF,CADsC,CAK/B,YAAY,OAAqB,CACtCgF,WAAW,IAAM,CACf,oFAAsF,OAEpFzB,QAFoF,CAAtF,CADe,CAKfwB,IALe,CAMfE,EAAO,UAAPA,6BAAO,CAAPA,CANFD,EAOG,KAPHA,aADsC,CAStC,gFAAkF,CAAlF,KAAkF,CAAlF,CATsC,CAUtCzB,oBACQ,IAAOwB,EAASE,EAAO,UAAhBF,UAAgB,CAAPE,CAATF,CADfxB,WAES,KAAS,CACd,wFAEE,OAAOA,OAAQA,EAAf,GAFF,KAEE,CAFF,CADc,CAKd0B,IAPJ1B,EAVF,CAAO,CAL+B,CAAtB,CAAZ,CAAN,4BA0BA2B,gBA1BA,CA2BA,YAAY,UAAoCpE,OAAQ,mBAAmB,KAA3E,MAAwD,CAA5C,CAAZ,CA3BA,yCAXF,cAyCA,gBAAiB,CACf,MAAOgB,aAAY,KAAZA,SAAP,IAAOA,EACR,CAED,YAAa,OACPoC,eAAc,KAAlB,OAAIA,CADO,CAC6B,iBAAiBU,KAAKA,EAA7B,KAAO,CAD7B,CAEX,QAAI,QAAO,MAAP,OAFO,CAIF,uBAAuB,cACNO,IAAS,gBADjC,KACwBA,CADM,CAAvB,IAJE,EAQXV,yCAA0C,KAA1CA,QARW,GAUZ,CAED,kBAAmB,OACbP,eAAc,KAAlB,OAAIA,CADa,CAER,mBAAP,CAAO,CAFQ,CAIjB,QAAI,QAAO,MAAP,OAJa,CAKR,uBAAuB,OAAe,MAAU,KAAvD,OAAuD,GAAV,CAAtC,IALQ,GAQlB,CAED,iBAAkB,CAChB,MAAO,uBAAsBU,KAAKA,EAAlC,KAAO,CACR,CAED3B,WAAiB,CACf,MACA,yCADA,CADe,uDACf,UAQE,KARF,MAiBA,KAjBA,EAkBE,wDAlBF,CAmBE,YAAY,qBAA2B,CACrCrB,KAAM,IAAM,CACV,uBAAuB,mBAA0B,CAC/CsB,cAD+C,CAA1B,CAAvB,CAFmC,EAMrCrB,KAAM,KAAW,CACf,uBAAuB,mBAA0B,SACxCqB,cADwC,CAA1B,CAAvB,CAPmC,EAWrCA,cAXqC,CAA3B,CAAZ,CAnBF,EAgCO,KAhCP,CAiCE1B,EAAKvB,MAALuB,MAAKvB,CAALuB,CAjCF,CAmCE,4DAnCF,MASI,wBAAuB,mBAA0B,gBAE/CC,MAAO,UAAW,sBAAqBxB,qBAAhC,GAFwC,CAA1B,CAAvB,CATJ,CAqCD,CAEDkD,SAAU,CAKR,MAJK,MAAL,IAIA,GAHE,WAGF,EADA,YACA,CAAO,KAAP,IACD,CAEDC,UAAgB,0GAIc,KAJd,qBAMd,KAAME,GAAUrD,IAAK,KAArB,QAAgBA,KAAhB,CANc,IAQDa,EAASwC,IAATxC,IAASwC,CARR,EAUd,KAAMD,GAAM,KAAZ,OAAY,EAAZ,CAgBA,MAdA,yCAA0C,6BAIxCA,KAJwC,CAA1C,CAcA,CAPA,uBAAuB,qBAA2B,8BAKhDH,cALgD,CAA3B,CAAvB,CAOA,EACD,CAtN8B,CA0NjC,QApPJzD,EA7DF,C,CCJgBA,EAAD,KAAY,CACzB2F,IADF,C,+bCCgB3F,EAAD,KAAY,CACzBA,mBAAyB,CAAC,sPAOI4F,gBAPJ,CAAD,GAQnB,CACJ,OAAa,CACX1F,iBAAyB,CACvBmC,qBADuB,CAGlB,KAAL,EAHuB,GAIrB,EAAEgB,EAAF,MAJqB,CAKrB,QAAUA,EAAV,MALqB,CAOxB,CAED,UAAW,OACLpD,GAAU,KAAd,MAAIA,CADK,CACmB,SADnB,CAET,UAAI,QAAO,MAAP,MAFK,CAE8B,UAF9B,CAGT,OACD,CAED4F,SAAe,MACPC,GAAY,CAChB3D,KAAM4D,EAAgB,KAAhBA,KAA2BvF,MADjB,MACiBA,CAA3BuF,CADU,CAEhB3D,KAAM2D,EAAgB,KAAhBA,KAA2BvF,MAA3BuF,MAA2BvF,CAA3BuF,CAFU,CADL,CAMPC,EAAiB3D,iBAAkB,KAAzC,MAAyC,EAAlBA,KANV,CAOb,eACD,CAED4D,QAAS,CACP,WA2BA,MAzBA,gGAAyF,KAAU,CAEjG,GADAjC,YACA,SAAIkC,IAAJ,CACA,aACE,OACE,WADF,CAEE,MAEF,OACE,WADF,CAEE,MAEF,UACE,WADF,CAEE,MAEF,YACE,WADF,CAEE,MAEF,QAjBF,CAHF,EAyBA,EACD,CAEDC,UAAUC,EAAVD,KAAwB,gDAGhB9E,EAAS,YAAY,QAA3B,MAA2B,CAAZ,CAHO,CAMtB,MAAOgB,eADP,KACOA,CAAmB,UAA1B,SAA0B,CAAnBA,CACR,CAhEU,CAmIb,MAhEAgE,sBACkB,aAEd9E,KAFc,UAGd+E,aAAc,IAHA,CADlBD,oBAMsB,CAClB9E,KADkB,qBAGlB+E,aAAc,IAHI,CANtBD,mBAWqB,CACjB9E,KADiB,oBAGjB+E,aAAc,IAHG,CAXrBD,mBAgBqB,CACjB9E,KADiB,SAEjBgF,SAFiB,QAGjBD,aAAc,IAHG,CAhBrBD,iBAqBmB,CACf9E,KADe,uBAGf+E,aAAc,KAHC,CArBnBD,eA0BiB,aAEb9E,KAAM,SAFO,CA1BjB8E,iBA8BmB,CACf9E,KADe,uBAGf+E,aAAc,KAHC,CA9BnBD,wCAqCqB,aAEjBG,UAFiB,QAGjBC,MAAO,CAAC,CAAC,KAAO,CACd,KAAMC,GAAS,cAAf,QAAe,GAAf,CAMA,QAPM,KASD,IAAM,UATN,+BASM,CATL,CAAD,CAHU,CArCrBL,yBAmD2B,aAEvBG,UAFuB,QAGvBC,MAAO,CAAC,CAACE,KAAK,YAAN,QAAM,GAAN,IAKD,IAAM,UALN,sCAKM,CALL,CAAD,CAHgB,CAnD3BN,CAgEA,CAFAhD,UAEA,EA5IFrD,EADF,C,CCDgBA,EAAD,KAAY,CACzBqB,IADF,C,CCFA,qD,CAAA,8C,CAAA,sD,CAAA,uD,CAAA,+D,CAAA,0C,CAAA,0C,CAAA,yC,CAAA,6C,CAAA,qC,CAAA,mC,CAAA,yC,CAAA,gD,CAAA,oC,CAAA,4C,OAeIrB,CCPW,IAAM,CACnB,KAAMA,GAAS,GAAI4G,GAAnB,EAOA,MANAxD,KAMA,CALAyD,IAKA,CAJAC,IAIA,CAHAhD,IAGA,CAFA6B,IAEA,CADAtE,IACA,EARF,CDOIrB,IAAS+G,S,MAXXzG,G,EAAAA,K,CAAO0G,E,EAAAA,W,CAAaC,E,EAAAA,kB,CAAoBC,E,EAAAA,M,CAAQC,E,EAAAA,c,CAChDtC,E,EAAAA,uB,CACEuC,E,EAAAA,gB,CACAC,E,EAAAA,wB,CACAC,E,EAAAA,yB,CACAC,E,EAAAA,iC,CACAC,E,EAAAA,Y,CACAC,E,EAAAA,Y,CACAC,E,EAAAA,W,CACAC,E,EAAAA,e,CACAC,E,EAAAA,O,cEdJ,6B,cAAA,mC,cAAA,4C,IfAA,C","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"freactal3\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"freactal3\"] = factory();\n\telse\n\t\troot[\"freactal3\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ce2e5337747630955c5f","module.exports = require(\"lodash.get\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash.get\"\n// module id = 0\n// module chunks = 0","/* eslint-disable no-unreachable */\nimport { combineLatest, BehaviorSubject, from } from 'rxjs';\nimport { map, distinctUntilChanged, pairwise, filter } from 'rxjs/operators';\nimport lGet from 'lodash.get';\nimport lClone from 'lodash.clonedeep';\n\nexport default (bottle) => {\n  bottle.factory(\n    'Store',\n    ({\n      STORE_STATE_UNSET_VALUE,\n      STORE_STATUS_NEW,\n      STORE_STATUS_INITIALIZING,\n      STORE_STATUS_INITIALIZATION_ERROR,\n      STORE_STATUS_INITIALIZED,\n      STORE_STATUS_STOPPED,\n      NOT_SET,\n      Change,\n      p, call, isPromise,\n    }) => {\n      class Store {\n        constructor(props = null) {\n          this._idFromProps(props);\n          this._parseProps(props);\n\n          this._initChangeStream();\n          this._initStateStream();\n          this._initErrorStream();\n          this._initStream();\n\n\n          if (this._debug) {\n            this._initDebugStream();\n          }\n\n          this._setStatus(STORE_STATUS_NEW);\n        }\n\n        stop() {\n          this._setStatus(STORE_STATUS_STOPPED);\n          this._changeStream.complete();\n          this._stateStream.complete();\n          this._stream.complete();\n          this._errorStream.complete();\n          if (this._debugStream) this._debugStream.complete();\n        }\n\n        _idFromProps(props) {\n          if (!Store._nextID) Store._nextID = 0;\n          if (props) {\n            const id = lGet(props, 'id');\n            if ((id) && Number.isInteger(id) && (id >= Store._nextID)) {\n              this.id = id;\n              Store.nextID = id + 1;\n              return;\n            } else if (id && (typeof id === 'string')) {\n              this.id = id;\n            }\n          }\n          Store._nextID += 1;\n          this.id = Store._nextID;\n        }\n\n        /**\n         * props can be:\n         *\n         * 1: a function, in which case its the initializer.\n         * 2: an object with state or initializer as props, in which case its a parameter group\n         * 3. an object without state or initializer in which case its the firstState\n         *\n         * @param props\n         * @private\n         */\n\n        _parseProps(props) {\n          this._idFromProps(props);\n          this._firstState = STORE_STATE_UNSET_VALUE;\n          if (!props) return;\n          if (typeof props === 'function') {\n            props = { initializer: props };\n          }\n          let debug = false;\n          let initializer = null;\n          let firstState = STORE_STATE_UNSET_VALUE;\n          let noChangeBeforeInit = true;\n\n          if (typeof props === 'object') {\n            if ('state' in props || 'initializer' in props) {\n              initializer = lGet(props, 'initializer', initializer);\n              firstState = lGet(props, 'state', firstState);\n              debug = lGet(props, 'debug', debug);\n              noChangeBeforeInit = lGet(props, 'noChangeBeforeInit', noChangeBeforeInit);\n            } else {\n              firstState = props;\n            }\n\n            this._firstState = firstState;\n            this._initializer = initializer;\n          } else {\n            this._firstState = props;\n          }\n\n          this._noChangeBeforeInit = noChangeBeforeInit;\n          this._debug = debug;\n        }\n\n        _initStateStream() {\n          this._stateStream = new BehaviorSubject(this._firstState)\n            .pipe(distinctUntilChanged());\n          this._stateStream.subscribe((next) => {\n            this._state = next;\n          });\n        }\n\n        _initErrorStream() {\n          this._errorStream = new BehaviorSubject()\n            .pipe(distinctUntilChanged());\n        }\n\n        _initDebugStream() {\n          this._debugStream = new BehaviorSubject()\n            .pipe(map((data) => {\n              const params = data.params;\n              let change = null;\n              if (params instanceof Change) {\n                switch (params.type) {\n                  case 'value':\n                    if (typeof params.change === 'symbol') {\n                      change = params.change.toString();\n                    } else {\n                      try {\n                        change = JSON.stringify(params.change);\n                      } catch (err) {\n                        change = params.change;\n                      }\n                    }\n                    break;\n\n                  default:\n                    change = `change -- ${params.type}`;\n                }\n                return Object.assign({}, data, {\n                  store_state: this.state, store_status: this.status, change,\n                });\n              }\n              return Object.assign({}, data, {\n                store_state: this.state, store_status: this.status, params,\n              });\n            }));\n          this._errorStream.subscribe((error) => {\n            this._debugStream.next({\n              source: '----(errorStream)',\n              message: 'error',\n              params: error,\n            });\n          });\n\n          this._changeStream.subscribe((params) => {\n            this._debugStream.next({\n              source: '-----(changeStream)',\n              message: 'params',\n              params,\n            });\n          });\n\n          this._stateStream.subscribe((state) => {\n            this._debugStream.next({\n              source: '----(stateStream)',\n              message: 'state',\n              params: state,\n            });\n          });\n        }\n\n        _initStream() {\n          this._stream = combineLatest(this._stateStream, this._statusStream)\n            .pipe(map(([streamedState, streamedStatus]) => ({\n              state: streamedState,\n              status: streamedStatus,\n            })), distinctUntilChanged());\n        }\n\n        _resolveChangePromise(params) {\n          const {\n            change,\n            fail = NOT_SET,\n          } = params;\n\n          this._debugMessage('change stream', 'is promise', params);\n          return change\n            .then((newChange) => {\n              this._debugMessage('change stream', '============= resolved', { params, newChange });\n              this.change({ ...params, change: newChange });\n            })\n            .catch((error) => {\n              call(fail, error);\n              this._errorStream.next({\n                ...params,\n                error,\n              });\n            });\n        }\n\n        _resolveChangeFunction(params) {\n          this._debugMessage('_resolveChangeFunction', 'chaining', params);\n          this.change({ ...params, change: params.change(this.state) });\n        }\n\n        /**\n         * depracated; built into Change.\n         *\n         * @param params\n         * @param extension\n         * @returns {*}\n         * @private\n         */\n        _extendParams(params, extension) {\n          if (typeof params === 'function') {\n            return this._extendParams({ change: params }, extension);\n          }\n          if (isPromise(params)) {\n            return this._extendParams({ change: params }, extension);\n          }\n\n          const { done: oDone, fail: oFail } = params;\n          const { done: eDone, fail: eFail } = extension;\n          let done = oDone;\n          let fail = oFail;\n\n          if (eDone) {\n            done = async (...args) => {\n              await call(oDone, ...args);\n              return call(eDone, ...args);\n            };\n          }\n\n          if (eFail) {\n            fail = async (...args) => {\n              await call(oFail, ...args);\n              return call(eFail, ...args);\n            };\n          }\n\n          return Object.assign({}, params, extension, { done, fail });\n        }\n\n        _delayedChange(params) {\n          // until status is updated changes are buffered\n          this._debugMessage('change stream', 'delaying execution until initializing is done', params);\n          this.onInit(params);\n        }\n\n        _changeError(error, params) {\n          const {\n            fail = NOT_SET,\n          } = params;\n\n          this._debugMessage('change stream', 'is error', { ...params, error });\n\n          call(fail, error, params);\n          this._errorStream.next({\n            ...params,\n            error,\n          });\n        }\n\n        _initChangeStream() {\n          this._changeStream = new BehaviorSubject(NOT_SET);\n          this._changeStream.subscribe(params => this.onChange(params), (error) => {\n            this._errorStream.next({\n              message: 'change stream error',\n              error,\n            });\n          });\n        }\n\n        onChange(params = NOT_SET) {\n          if (params === NOT_SET) {\n            return;\n          }\n\n          if (typeof params !== 'object') {\n            this.onChange({ change: params });\n            return;\n          }\n\n          const {\n            change = NOT_SET,\n            done,\n            status,\n          } = params;\n\n          if (this.isInitializeError) {\n            this._changeError(this.initializationError, params);\n            return;\n          }\n\n          if (!params) {\n            this._changeError(new Error('no change specified'), params);\n            return;\n          }\n\n          if (this._noChangeBeforeInit && !status) {\n            switch (this.status) {\n              case STORE_STATUS_INITIALIZING:\n                this._debugMessage('onChange', 'change before init -- suppressing', params);\n                return;\n                break;\n\n              case STORE_STATUS_NEW:\n                this._debugMessage('onChange', 'change while new -- suppressing', params);\n                return;\n                break;\n\n              default:\n              // continue;\n            }\n          }\n\n          if (isPromise(change)) {\n            this._resolveChangePromise(params);\n            return;\n          }\n\n          if (typeof change === 'function') {\n            this._resolveChangeFunction(params);\n            return;\n          }\n\n          if (!this.isInitialized) {\n            if (!status) {\n              this._delayedChange(params);\n              return;\n            }\n          }\n\n          this._setState(change);\n\n          if (status) {\n            this._setStatus(status);\n          }\n          call(done, this.state);\n        }\n\n        change(params = NOT_SET) {\n          if (params === NOT_SET) return Promise.resolve(NOT_SET);\n          let init = params;\n          if (typeof params === 'object' && (!params.change)) {\n            init = { change: params };\n          }\n          const changeRecord = (params instanceof Change) ? params : new Change(init);\n          const [change, promise] = changeRecord.asPromise();\n          this._changeStream.next(change);\n          return promise;\n        }\n\n        get state() {\n          return this._state;\n        }\n\n        _setState(value = NOT_SET) {\n          if (value !== NOT_SET) {\n            this._stateStream.next(value);\n          }\n        }\n\n        get status() {\n          return this._status;\n        }\n\n        _setStatus(status) {\n          if ([\n            STORE_STATUS_NEW,\n            STORE_STATUS_INITIALIZING,\n            STORE_STATUS_INITIALIZED,\n            STORE_STATUS_INITIALIZATION_ERROR,\n          ].includes(status)) {\n            this._status = status;\n          }\n        }\n\n        subscribe(...args) {\n          return this._stateStream.subscribe(...args);\n        }\n\n        get isInitializing() {\n          return this.status === STORE_STATUS_INITIALIZING;\n        }\n\n        get isNotUninitialized() {\n          return this.isInitialized || this.isInitializeError;\n        }\n\n        get isInitialized() {\n          return (this.status === STORE_STATUS_INITIALIZED);\n        }\n\n        get isInitializeError() {\n          return (this.status === STORE_STATUS_INITIALIZATION_ERROR);\n        }\n\n        initialize() {\n          this._debugMessage('initialize', '==========initializing', {});\n          if (this._initPromise) return this._initPromise;\n          this._setState(this._firstState);\n          this._setStatus(STORE_STATUS_INITIALIZING);\n          if (this._initializer) {\n            this._initPromise = this.change({\n              change: this._initializer, status: STORE_STATUS_INITIALIZED,\n            });\n          } else {\n            this._initPromise = this.change({\n              change: this._firstState, status: STORE_STATUS_INITIALIZED,\n            });\n          }\n          return this._initPromise;\n        }\n\n        /**\n         * this method delays an action until the store has been initialized\n         * (or is in init error state).\n         *\n         * @param params {change} or legit arguments to the new change constructor.\n         *\n         * @returns {Promise<never>}\n         */\n        onInit(params) {\n          const {\n            fail,\n          } = params;\n\n          if (this.isInitialized) {\n            return this.change(params);\n          }\n\n          if (this.isInitializeError) {\n            call(fail, this.initializationError);\n            return Promise.reject(this.initializationError);\n          }\n\n          let changeRecord;\n          if (!(params instanceof Change)) {\n            changeRecord = new Change(params);\n          } else {\n            changeRecord = params;\n          }\n\n          const [change, promise] = changeRecord.asPromise();\n\n          const sub = this._statusStream.subscribe(\n            (status) => {\n              switch (status) {\n                case STORE_STATUS_INITIALIZED:\n                  sub.unsubscribe();\n                  this.change(change);\n                  break;\n\n                case STORE_STATUS_INITIALIZATION_ERROR:\n                  sub.unsubscribe();\n                  call(change.fail, this.initializationError, this);\n                  break;\n\n                default:\n              }\n            },\n            (error) => {\n              call(change.fail, error, this);\n            },\n          );\n\n          return promise;\n        }\n\n        _debugMessage(source, message, params) {\n          if (this._debug) {\n            this._debugStream.next({\n              source,\n              message,\n              params,\n            });\n          }\n        }\n      }\n\n      return Store;\n    },\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Store/Store.js","import store from './Store';\n\nexport default (bottle) => {\n  store(bottle);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Store/index.js","import { combineLatest, BehaviorSubject, from } from 'rxjs';\nimport { map, distinctUntilChanged, pairwise, filter } from 'rxjs/operators';\nimport lGet from 'lodash.get';\nimport lClone from 'lodash.clonedeep';\n\nexport default (bottle) => {\n  bottle.factory(\n    'Engine',\n    ({\n      STORE_STATE_UNSET_VALUE,\n      STORE_STATUS_NEW,\n      STORE_STATUS_INITIALIZING,\n      STORE_STATUS_INITIALIZATION_ERROR,\n      STORE_STATUS_INITIALIZED,\n\n      ACTION_START,\n      ACTION_COMPLETE,\n      ACTION_ERROR,\n\n      NOT_SET,\n      p, call, isPromise, explodePromise,\n      Store, Change,\n    }) => {\n      class Engine extends Store {\n        constructor(params, actions) {\n          super(params);\n          this._initActionStream();\n          this.mutators = actions || lGet(params, actions);\n          this.initialize();\n        }\n\n        get actions() {\n          if (!this._actions) {\n            const actions = {};\n\n            Object.keys(this.mutators)\n              .forEach((method) => {\n                actions[method] = (...params) => this.perform({\n                  method,\n                  actions,\n                  params,\n                });\n              });\n\n            this._actions = actions;\n          }\n          return this._actions;\n        }\n\n        _initActionStream() {\n          this.actionStream = new BehaviorSubject();\n          this.actionStream.subscribe(params => this.onAction(params), (error) => {\n            this._errorStream.next({ message: 'action error', error });\n          });\n        }\n\n        onAction(changeRecord) {\n          if (!changeRecord) return;\n          this._debugMessage('onAction', '(init)', changeRecord);\n          const {\n            actionStatus = NOT_SET,\n            change,\n          } = changeRecord;\n\n          if (!change) {\n            if (actionStatus !== ACTION_ERROR) {\n              this.actionStream.next(changeRecord.extend({\n                actionStatus: ACTION_ERROR,\n                error: new Error(`cannot find method ${lGet(changeRecord, 'method', '???')}`),\n              }));\n              return;\n            }\n          }\n\n          if (actionStatus === ACTION_START) {\n            this._debugMessage('onAction', 'chaining action call ', changeRecord);\n            this.change(changeRecord.extend({\n              done: () => {\n                this.actionStream.next(changeRecord.extend({\n                  actionStatus: ACTION_COMPLETE,\n                }));\n              },\n              fail: (error) => {\n                this.actionStream.next(changeRecord.extend({\n                  error, actionStatus: ACTION_ERROR,\n                }));\n              },\n              actionStatus: NOT_SET,\n            }));\n          } else if (actionStatus === ACTION_ERROR) {\n            call(lGet(changeRecord, 'fail'));\n          } else {\n            this._debugMessage('onAction', 'NOT chaining action call ', changeRecord);\n          }\n        }\n\n        _getTID() {\n          if (!this._tid) {\n            this._tid = 0;\n          }\n          this._tid += 1;\n          return this._tid;\n        }\n\n        perform(params) {\n          const changeRecord = new Change({\n            ...params,\n            tid: this._getTID(),\n            actionStatus: ACTION_START,\n          });\n\n          let {\n            // eslint-disable-next-line prefer-const\n            method, actions = this.actions, params: methodParams,\n          } = changeRecord;\n          const mutator = lGet(this.mutators, method);\n\n\n          if (mutator && typeof mutator === 'function') {\n            changeRecord.change = mutator(actions, ...methodParams);\n          }\n          this._debugMessage('perform', 'mutator:', changeRecord);\n          const { promise, change: actionChange } = changeRecord.asPromise();\n\n          this.actionStream.next(actionChange);\n\n          return promise;\n        }\n      }\n\n      return Engine;\n    },\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Engine/Engine.js","import engine from './Engine';\n\nexport default (bottle) => {\n  engine(bottle);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Engine/index.js","\n\nexport default (bottle) => {\n  bottle.constant('STORE_STATE_UNSET_VALUE', Symbol('STORE_STATE_UNSET_VALUE'));\n  bottle.constant('STORE_STATUS_NEW', Symbol('STORE_STATUS_NEW'));\n  bottle.constant('STORE_STATUS_INITIALIZED', Symbol('STORE_STATUS_INITIALIZED'));\n  bottle.constant('STORE_STATUS_STOPPED', Symbol('STORE_STATUS_STOPPED'));\n  bottle.constant('STORE_STATUS_INITIALIZING', Symbol('STORE_STATUS_INITIALIZING'));\n  bottle.constant('STORE_STATUS_INITIALIZATION_ERROR', Symbol('STORE_STATUS_INITIALIZATION_ERROR'));\n  bottle.constant('ACTION_ERROR', Symbol('ACTION_ERROR'));\n  bottle.constant('ACTION_START', Symbol('ACTION_START'));\n  bottle.constant('ACTION_NOOP', Symbol('ACTION_NOOP'));\n  bottle.constant('ACTION_COMPLETE', Symbol('ACTION_COMPLETE'));\n  bottle.constant('NOT_SET', Symbol('NOT_SET'));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/constants.js","export default (bottle) => {\n  /**\n   * decomposes a promise into result and error;\n   * returns these in an array which also has properties of result and error,\n   * so\n   *\n   * const [result, error] = p(promiseFn())\n   *\n   * is valid as is\n   *\n   * const {result, error} = p(promiseFn());\n   *\n   * accepts a promise, or a function that is called with the remaining arguments.\n   */\n  bottle.factory('p', () => async (first, ...args) => {\n    let error = null;\n    let result;\n    try {\n      if (typeof first === 'function') {\n        result = await first(...args);\n      } else {\n        result = await (first);\n      }\n    } catch (err) {\n      error = err;\n    }\n    const out = [result, error];\n    out.result = result;\n    out.error = error;\n    return out;\n  });\n\n  bottle.factory('call', () => (fn, ...args) => {\n    if (fn && typeof fn === 'function') {\n      return fn(args);\n    }\n    return null;\n  });\n\n  bottle.factory('explodePromise', ({ NOT_SET, isPromise }) => (promise) => {\n    let done = NOT_SET;\n    let fail = NOT_SET;\n\n    if (isPromise(promise)) {\n      done = (...args) => [...args];\n      fail = (...args) => [...args];\n      promise.then(done).catch(fail);\n    } else promise = new Promise((d, f) => { done = d; fail = f; });\n\n    return Object.assign([promise, done, fail], { done, fail, promise });\n  });\n\n  bottle.factory('update', () => function (delta) {\n    return (actions, ...args) => (state) => {\n      const change = delta(actions, ...args)(state);\n      return Object.assign({}, state, change);\n    };\n  });\n\n  bottle.factory('obj', () => (key, value) => {\n    const out = {};\n    out[key] = value;\n    return out;\n  });\n\n  bottle.constant('NOOP', a => a);\n\n  bottle.factory('isPromise', () => (subject) => {\n    if (!subject) return false;\n    if (subject instanceof Promise) return true;\n    return Promise.resolve(subject) === subject;\n  });\n\n  bottle.factory('functionCombine', ({ call }) => (f1, f2) => async (...args) => {\n    await call(f1, ...args);\n    return call(f2, ...args);\n  });\n\n  bottle.factory('mergeIntoState', () => change => state => Object.assign({}, state, change));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js","import { combineLatest, BehaviorSubject, from } from 'rxjs';\nimport { map, distinctUntilChanged, pairwise, filter } from 'rxjs/operators';\nimport lGet from 'lodash.get';\nimport lClone from 'lodash.clonedeep';\nimport lGroupBy from 'lodash.groupby';\n\nexport default (bottle) => {\n  bottle.factory('defaultActionReducer', () => function (engines) {\n    if (Array.isArray(engines)) {\n      return engines.reduce((actionsMemo, engine) => {\n        // with an array, actions will shadow other actions of the\n        // same name preferring right most engines. However all original\n        // actions will be available in the baseActions array.\n        let baseActions = actionsMemo.baseActions;\n        if (baseActions) {\n          baseActions = [...baseActions, engine.actions];\n        } else {\n          baseActions = [engine.actions];\n        }\n        const actions = { ...actionsMemo, baseActions };\n        Object.keys(engine.mutators).forEach((method) => {\n          actions[method] = (...params) => engine.perform({\n            actions, method, params,\n          });\n        });\n        return actions;\n      }, {});\n    } else if (typeof engines === 'object') {\n      const actions = { baseActions: {} };\n\n      Object.keys(engines).forEach((engineName) => {\n        const engine = engines[engineName];\n        actions[engineName] = {};\n        Object.keys(engine.mutators).forEach((method) => {\n          const action = (...params) => engine.perform({\n            actions, method, params,\n          });\n          actions[engineName][method] = action;\n          actions[method] = action;\n          actions.baseActions[engineName] = engine.actions;\n        });\n      });\n      return actions;\n    }\n    throw new Error('bad engines for defaultActionReducer');\n  });\n\n  bottle.factory('defaultStateReducer', ({\n    STORE_STATE_UNSET_VALUE,\n  }) => (states) => {\n    if (states === STORE_STATE_UNSET_VALUE) return states;\n    if (Array.isArray(states)) {\n      return states.reduce((newState, state) => ({ ...newState, ...state }), {});\n    } else if (typeof states === 'object') {\n      const newState = {};\n      Object.keys(states).forEach((engineName) => {\n        Object.keys(states[engineName]).forEach((fieldName) => {\n          newState[fieldName] = states[engineName][fieldName];\n        });\n        Object.assign(newState, states);\n      });\n      return newState;\n    }\n    console.log('bad state:', states);\n    throw new Error('bad state passed to defaultStateReducer');\n  });\n\n  bottle.factory(\n    'EngineMerger',\n    ({\n      STORE_STATUS_NEW,\n      STORE_STATUS_INITIALIZING,\n      STORE_STATUS_INITIALIZATION_ERROR,\n      STORE_STATUS_INITIALIZED,\n      STORE_STATE_UNSET_VALUE,\n\n      defaultActionReducer,\n      defaultStateReducer,\n      ACTION_START,\n      ACTION_COMPLETE,\n      ACTION_ERROR,\n\n      NOT_SET,\n      p, call, isPromise, explodePromise, obj,\n      Store,\n    }) => {\n      const STATUS_MAP = new Map();\n      STATUS_MAP.set(STORE_STATUS_NEW, 'new');\n      STATUS_MAP.set(STORE_STATUS_INITIALIZATION_ERROR, 'error');\n      STATUS_MAP.set(STORE_STATUS_INITIALIZED, 'initialized');\n      STATUS_MAP.set(STORE_STATUS_INITIALIZING, 'initializing');\n      STATUS_MAP.set(NOT_SET, 'other');\n\n      class EngineMerger extends Store {\n        constructor(params) {\n          super(params);\n          this._initActionStream();\n\n          this.initialize();\n        }\n\n        _parseProps(params) {\n          this._idFromProps(params);\n\n          this.engines = lGet(params, 'engines', []);\n          this._stateReducer = lGet(params, 'stateReducer', defaultStateReducer);\n          this._actionsReducer = lGet(params, 'actionReducer', defaultActionReducer);\n          this._firstState = lGet(params, 'state', STORE_STATE_UNSET_VALUE);\n          this._maxInitWait = lGet(params, 'maxInitWait', 10 * 1000);\n          this._listenToEngineStreams();\n          this._debug = lGet(params, 'debug', params);\n        }\n\n        get actions() {\n          if (!this._actions) {\n            this._actions = this._actionsReducer(this.engines);\n          }\n          return this._actions;\n        }\n\n        _listenToEngineStreams() {\n          this.enginesArray.forEach(e => e.subscribe(() => {\n            this._updateState();\n          }, (err) => {\n            console.log('error on ', e, err);\n          }, () => {\n            console.log('engine shut down');\n          }));\n        }\n\n        _updateState() {\n          if (this.status === STORE_STATUS_INITIALIZED) {\n            this._stateStream.next(this._stateReducer(this.states));\n          }\n        }\n\n        _initActionStream() {\n          this.actionStream = new BehaviorSubject();\n          this.actionStream.subscribe(params => this.onAction(params), (error) => {\n            this._errorStream.next({ message: 'action error', error });\n          });\n        }\n\n        initialize() {\n          this._debugMessage('initialize', '========== initializing', {});\n          if (this._initPromise) return this._initPromise;\n          this._setState(this.c);\n          this._setStatus(STORE_STATUS_INITIALIZING);\n          if (this._initializer) {\n            this._initPromise = this.change({\n              change: this._waitForRelatedEnginesInitialize(), status: STORE_STATUS_INITIALIZED,\n            });\n          } else {\n            this._initPromise = this.change({\n              change: this._firstState, status: STORE_STATUS_INITIALIZED,\n            })\n              .then(() => this._waitForRelatedEnginesInitialize());\n          }\n          return this._initPromise;\n        }\n\n        async _waitForRelatedEnginesInitialize() {\n          let failed = false;\n          const tid = this._getTID();\n          this._debugMessage('_waitForRelatedEnginesInitialize', 'waiting for engines', {\n            tid,\n            engines: this.engines,\n          });\n          const killSwitch = setTimeout(() => {\n            failed = true;\n            this.change(Promise.reject(new Error('initialization took too long')));\n          }, this._maxInitWait);\n          await Promise.all(this.enginesArray.map((engine) => {\n            this._debugMessage('_waitForRelatedEnginesInitialize', 'awaiting engine timeout:', {\n              tid,\n              engine: `engine ${engine.id}`,\n            });\n            return new Promise((resolve, reject) => {\n              setTimeout(() => {\n                this._debugMessage('_waitForRelatedEnginesInitialize', 'engine failed to initialize', {\n                  tid,\n                  engine,\n                });\n                failed = true;\n                reject(new Error('engine failed to initialize'));\n              }, this._maxInitWait);\n              this._debugMessage('_waitForRelatedEnginesInitialize', 'all engines initialized', { tid });\n              engine.initialize()\n                .then(() => (failed ? reject(new Error('too late')) : resolve()))\n                .catch((err) => {\n                  this._debugMessage(\n                    '_waitForRelatedEnginesInitialize', 'engine initialization failure: ',\n                    { err, engine: engine.id, tid },\n                  );\n                  reject(err);\n                });\n            });\n          }));\n          clearTimeout(killSwitch);\n          this.change({ status: STORE_STATUS_INITIALIZED, change: this._stateReducer(this.states) });\n        }\n\n        get engineKeys() {\n          return Object.keys(this.engines).sort();\n        }\n\n        get states() {\n          if (Array.isArray(this.engines)) return this.engines.map(e => e.state);\n          if (typeof this.engines === 'object') {\n            // eslint-disable-next-line arrow-body-style\n            return this.engineKeys.reduce((memo, key) => {\n              return ({ ...memo, ...obj(key, this.engines[key].state) });\n            }, {});\n          }\n          console.log('this engines is not right:', this.engines);\n          return STORE_STATE_UNSET_VALUE;\n        }\n\n        get enginesArray() {\n          if (Array.isArray(this.engines)) {\n            return this.engines.slice(0);\n          }\n          if (typeof this.engines === 'object') {\n            return this.engineKeys.reduce((memo, key) => [...memo, this.engines[key]], []);\n          }\n          return [];\n        }\n\n        get statesArray() {\n          return this.enginesArray.map(e => e.state);\n        }\n\n        onAction(params) {\n          if (!params) return;\n          this._debugMessage('onAction', '(init)', params);\n          const {\n            actionStatus = NOT_SET,\n            change,\n          } = params;\n\n          if (!change) {\n            if (actionStatus !== ACTION_ERROR) {\n              this.actionStream.next(Object.extend({}, params, {\n                actionStatus: ACTION_ERROR,\n                error: new Error(`cannot find method ${lGet(params, 'method', '???')}`),\n              }));\n              return;\n            }\n          }\n\n          if (actionStatus === ACTION_START) {\n            this._debugMessage('onAction', 'chaining action call ', params);\n            this.change(this._extendParams(params, {\n              done: () => {\n                this.actionStream.next(Object.assign({}, params, {\n                  actionStatus: ACTION_COMPLETE,\n                }));\n              },\n              fail: (error) => {\n                this.actionStream.next(Object.assign({}, params, {\n                  error, actionStatus: ACTION_ERROR,\n                }));\n              },\n              actionStatus: NOT_SET,\n            }));\n          } else if (actionStatus === ACTION_ERROR) {\n            call(lGet(params, 'fail'));\n          } else {\n            this._debugMessage('onAction', 'NOT chaining action call ', params);\n          }\n        }\n\n        _getTID() {\n          if (!this._tid) {\n            this._tid = 0;\n          }\n          this._tid += 1;\n          return this._tid;\n        }\n\n        perform(params) {\n          const [promise, done, fail] = explodePromise();\n          let {\n            // eslint-disable-next-line prefer-const\n            method, change, actions = this.actions, params: methodParams,\n          } = params;\n          const mutator = lGet(this.mutators, method, NOT_SET);\n\n          if (mutator) change = mutator(actions, ...methodParams);\n\n          const tid = this._getTID();\n\n          this._debugMessage('perform', 'mutator:', {\n            mutator,\n            params,\n            change,\n            tid,\n          });\n\n          this.actionStream.next(this._extendParams(params, {\n            done,\n            fail,\n            tid,\n            change,\n            actionStatus: ACTION_START,\n          }));\n          return promise;\n        }\n      }\n\n\n      return EngineMerger;\n    },\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/EngineMerger/EngineMerger.js","import engineMerger from './EngineMerger';\n\nexport default (bottle) => {\n  engineMerger(bottle);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/EngineMerger/index.js","import lGet from 'lodash.get';\nimport propper from '@wonderlandlabs/propper';\n\nexport default (bottle) => {\n  bottle.factory('Change', ({\n    ACTION_ERROR, ACTION_START, ACTION_NOOP, ACTION_COMPLETE, NOOP, NOT_SET,\n    STORE_STATE_UNSET_VALUE,\n    STORE_STATUS_NEW,\n    STORE_STATUS_INITIALIZING,\n    STORE_STATUS_INITIALIZATION_ERROR,\n    STORE_STATUS_INITIALIZED,\n    isPromise, functionCombine, explodePromise,\n  }) => {\n    class Change {\n      constructor(params = {}) {\n        Object.assign(this, params);\n\n        if (!this.id) {\n          ++Change.nextID;\n          this.id = Change.nextID;\n        }\n      }\n\n      get type() {\n        if (isPromise(this.change)) return 'promise';\n        if (typeof this.change === 'function') return 'function';\n        return 'value';\n      }\n\n      extend(params) {\n        const callbacks = {\n          done: functionCombine(this.done, lGet(params, 'done')),\n          fail: functionCombine(this.fail, lGet(params, 'fail')),\n        };\n\n        const combinedParams = Object.assign({}, this.toJSON(), params, callbacks);\n        return new Change(combinedParams);\n      }\n\n      toJSON() {\n        const out = {};\n\n        ('tid,actions,params,method,done,id,fail,change,status,actionStatus'.split(',')).forEach((name) => {\n          out[name] = this[name];\n          if (name === 'change') return;\n          switch (out[name]) {\n            case NOOP:\n              delete out[name];\n              break;\n\n            case NOT_SET:\n              delete out[name];\n              break;\n\n            case null:\n              delete out[name];\n              break;\n\n            case undefined:\n              delete out[name];\n              break;\n\n            default:\n              // no change\n          }\n        });\n\n        return out;\n      }\n\n      asPromise(after = null) {\n        const [promise, done, fail] = explodePromise(after);\n\n        const change = this.extend({ done, fail });\n\n        const out = [change, promise];\n        return Object.assign(out, { change, promise });\n      }\n    }\n\n    propper(Change)\n      .addProp('tid', {\n        required: false,\n        type: 'integer',\n        defaultValue: null,\n      })\n      .addProp('actions', {\n        type: 'object',\n        required: false,\n        defaultValue: null,\n      })\n      .addProp('params', {\n        type: 'array',\n        required: false,\n        defaultValue: null,\n      })\n      .addProp('method', {\n        type: 'string',\n        required: 'false',\n        defaultValue: null,\n      })\n      .addProp('done', {\n        type: 'function',\n        required: false,\n        defaultValue: () => NOOP,\n      })\n      .addProp('id', {\n        required: true,\n        type: 'integer',\n      })\n      .addProp('fail', {\n        type: 'function',\n        required: false,\n        defaultValue: () => NOOP,\n      })\n      .addProp('change', {\n      })\n      .addProp('status', {\n        required: false,\n        onInvalid: 'throw',\n        tests: [[(n) => {\n          const isGood = [STORE_STATE_UNSET_VALUE,\n            NOT_SET,\n            STORE_STATUS_NEW,\n            STORE_STATUS_INITIALIZING,\n            STORE_STATUS_INITIALIZATION_ERROR,\n            STORE_STATUS_INITIALIZED].includes(n);\n          return isGood;\n        },\n        false, () => new Error('status must be an store state')]],\n      })\n      .addProp('actionStatus', {\n        required: false,\n        onInvalid: 'throw',\n        tests: [[n => [ACTION_ERROR,\n          NOT_SET,\n          ACTION_START,\n          ACTION_NOOP,\n          ACTION_COMPLETE].includes(n),\n        false, () => new Error('actionStatus must be an action state')]],\n      });\n\n    Change.nextID = 0;\n\n    return Change;\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Change/Change.js","import change from './Change';\n\nexport default (bottle) => {\n  change(bottle);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/Change/index.js","import bottle from './bottle';\n\n\nconst {\n  Store, StoreEngine, StoreEngineReducer, update, mergeIntoState,\n  STORE_STATE_UNSET_VALUE\n  , STORE_STATUS_NEW\n  , STORE_STATUS_INITIALIZED\n  , STORE_STATUS_INITIALIZING\n  , STORE_STATUS_INITIALIZATION_ERROR\n  , ACTION_ERROR\n  , ACTION_START\n  , ACTION_NOOP\n  , ACTION_COMPLETE\n  , NOT_SET,\n} = bottle().container;\nexport {\n  STORE_STATE_UNSET_VALUE\n  , STORE_STATUS_NEW\n  , STORE_STATUS_INITIALIZED\n  , STORE_STATUS_INITIALIZING\n  , STORE_STATUS_INITIALIZATION_ERROR\n  , ACTION_ERROR\n  , ACTION_START\n  , ACTION_NOOP\n  , ACTION_COMPLETE\n  , NOT_SET,\n  Store,\n  StoreEngine,\n  StoreEngineReducer,\n  update,\n  mergeIntoState,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import Bottle from 'bottlejs';\nimport store from './Store';\nimport engine from './Engine';\nimport constants from './constants';\nimport util from './util';\nimport engineMerger from './EngineMerger';\nimport change from './Change';\n\nexport default () => {\n  const bottle = new Bottle();\n  store(bottle);\n  constants(bottle);\n  util(bottle);\n  engine(bottle);\n  engineMerger(bottle);\n  change(bottle);\n  return bottle;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/bottle.js","module.exports = require(\"bottlejs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bottlejs\"\n// module id = 6\n// module chunks = 0"],"sourceRoot":""}